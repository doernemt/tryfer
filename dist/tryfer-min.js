"use strict";!function(){var t=angular.module("tryfer",[]);t.provider("Tryfer",function(){var t={},n={};t.init=function(t,n){t.setSampleRate=function(t){(void 0===t||null===t)&&(t=.01),n.sampleRate=t},t.setRestkin=function(t){n.restkinUrl=t},t.setName=function(t){n.serviceName=t},t.setHost=function(t){n.hostHash=t}},t.init(this,n),this.$get=["$http",function(t){function e(n){function e(t){var n=t,e=n.split(".");return(256*(256*(256*+e[0]+ +e[1])+ +e[2])+ +e[3]).toString()}function a(t,n){var e=t.toString(16);return(void 0===n||null===n)&&(n=16),e.length<n?new Array(n+1-e.length).join("0")+e:e}function r(){return Math.floor(Math.random()*l)}function o(){return 1e3*Date.now()}function s(t){var e;if(e=void 0===n.sampleRate||null===n.sampleRate?.1:n.sampleRate,(void 0===t||null===t)&&(t={}),!(Math.random()<=e))return u.sampleRate=!1,u;u.sampleRate=!0;var o=t["X-B3-TraceId"]||r(),s=r(),i=t["X-B3-SpanId"]||null,l={trace_id:a(o),span_id:a(s),name:name,annotations:[]};null!==i&&(l.parent_id=a(i));var c=u.getHost();return u.span=l,u.host=c,u}var i={},u={},l=Math.pow(2,53)-1;return u.getHost=function(){var t=n.hostHash,a=t.ip,r=t.port,o=t.service_name;(void 0===a||null===a)&&(a="127.0.0.1"),(void 0===r||null===r)&&(r=80),(void 0===o||null===o)&&(o="tryfer:default");var s={ipv4:e(a),port:r,service_name:o};return s},u.getHeaders=function(){var t={};if(u.sampleRate===!1)return t;var n=u.span;return t["X-B3-TraceId"]=n.trace_id,t["X-B3-SpanId"]=n.span_id,t["X-B3-ParentSpanId"]=n.parent_id,t},u.clientSend=function(){if(u.sampleRate===!1)return u;var t={type:"timestamp",key:"cs",value:o(),host:u.host||u.getHost()};return u.span.annotations.push(t),u},u.clientReceive=function(){if(u.sampleRate===!1)return u;var t={type:"timestamp",key:"cr",value:o(),host:u.host||u.getHost()};return u.span.annotations.push(t),u.sendData(),u},u.sendData=function(){if(u.sampleRate===!1)return"sampleRate is false";var e=[];e.push(u.span),t.post(n.restkinUrl,e,{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST"}).success(function(){console.log("trace success")}).error(function(){console.log("trace error")})},u.record=function(t,n,e){if(u.sampleRate===!1)return u;var a={type:t,key:n,value:e,host:u.host||u.getHost()};return u.span.annotations.push(a),u},i.initTrace=_.bind(s),i}return e(n)}]})}();